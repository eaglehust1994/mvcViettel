<div id="formDetail" data-ng-controller="ltaFromOfferSclipController as vm" kendo-validator="vm.validator" k-options="vm.validatorOptions">
	<div class="light">
		<div class="portlet-body form">
			<form class="form-horizontal row" role="form" id="detailAssetForm">
				<div class="form-body margin-top">
					<div class="clearfix">
						<div class="margin-bottom-asset col-md-6">
							<label class="col-md-4 control-label " translate>Biên bản nghiệm thu đưa vào SD số</label>
							<div class="col-md-8">
								<input type="text"  class="form-control" name="handoverCode" id="handoverCode" maxlength="30" ng-model="vm.detail.handoverCode" required data-required-msg="Số biên bản bàn giao không được để trống" />
								<span data-for="handoverCode" class="k-invalid-msg"></span>
							</div>
						</div>
						<div class="margin-bottom-asset col-md-6">
							<label class="col-md-4 control-label" translate>Ngày nghiệm thu đưa vào SD</label>
							<div class="col-md-8">
								<input class="form-control date width100"  kendo-date-picker name="depreciationStartDate" id="depreciationStartDate"  ng-model="vm.detail.depreciationStartDate"  k-format="'dd/MM/yyyy'" required data-date-msg="Ngày không đúng định dạng!" data-required-msg="Ngày bàn giao đưa vào SD không được để trống" />
								<span data-for="depreciationStartDate" class="k-invalid-msg"></span>								
							</div>
						</div>
					</div>
					<div class="clearfix">
						
						<div class="margin-bottom-asset col-md-6">

							<label class="col-md-4 control-label" translate>Mã công trình</label>
							<div class="col-md-8">
							<div class="input-icon right">
								<i class="fa fa-chevron-down " ng-click="vm.autocompleteConstr1.search();" style="cursor: pointer"></i>
                            <input kendo-auto-complete="vm.autocompleteConstr1" k-options="vm.autocompleteConstr"
                                   ng-model="vm.detail.constructName" required data-required-msg="Công trình không được để trống"
                                   class="form-control width100" name="constructName" id="constructId"/>
                                  	<span data-for="constructId" class="k-invalid-msg"></span>
								</div>
							<!-- <input type="text" class="form-control"  ng-model="vm.detail.constructName"   /> -->
								</div>
						</div>
						<div class="margin-bottom-asset col-md-6">
							<label class="col-md-4 control-label" translate>Mã trạm</label>
							<div class="col-md-8">
							<input  type="text" class="form-control width100"  ng-model="vm.detail.stationCode"   readonly/>
								</div>
						</div>
					</div>
					<div class="clearfix">
						<div class="margin-bottom-asset col-md-6">
							<label class="col-md-4 control-label" translate>Mã dự án đầu tư</label>
							<div class="col-md-8">
								<input  type="text" class="form-control width100"   ng-model="vm.detail.investProjectCode"  />
							</div>
						</div>
						<div class="margin-bottom-asset col-md-6">
							<label class="col-md-4 control-label" translate>Mã hợp đồng xây lắp</label>
							<div class="col-md-8">
								<input  type="text" class="form-control width100"   ng-model="vm.detail.contractCode"  />
							</div>
						</div>
					</div>
				
				

					<div class="clearfix">
					
						 <div class="margin-bottom-asset col-md-6">
                        <label class="col-md-4 control-label req" translate>Đơn vị hạch toán</label>
                        <div class="col-md-8">
							<div class="input-icon right">
								<i class="fa fa-chevron-down " ng-click="vm.sysGroup.search();" style="cursor: pointer"></i>
                            <input kendo-auto-complete="vm.sysGroup" k-options="vm.sysGroupOptions"
                                   ng-model="vm.detail.groupName" required data-required-msg="Đơn vị hạch toán không được để trống"
                                   class="form-control width100" name="groupCode" id="groupCode" />
                                   	<span data-for="groupCode" class="k-invalid-msg"></span>
								</div>
                        </div>
                        </div>
					
					 <div class="margin-bottom-asset col-md-6">
                        <label class="col-md-4 control-label req" translate>Đơn vị sử dụng</label>
                        <div class="col-md-8">
							<div class="input-icon right">
								<i class="fa fa-chevron-down " ng-click="vm.sysUserGroup.search();" style="cursor: pointer"></i>
								 <input kendo-auto-complete="vm.sysUserGroup" k-options="vm.sysUserGroupOptions"
                                   ng-model="vm.detail.useGroupName" required data-required-msg="Đơn vị sử dụng không được để trống"
                                   class="form-control width100" name="groupUserCode"  />
                                   	<span data-for="groupUserCode" class="k-invalid-msg"></span>
								</div>
                        </div>
                    </div>
					</div>
					<div class="clearfix">
						<combo-box-asset 
							searchtype="assetCode" 
							
							msg="Nhóm tài sản không được để trống"
							model-label="Nhóm tài sản" 
							caller="vm" 
							popup-id="cat_asset_detail_assetGroup" 
							popup-type="grid" 
							popup-source-link="catAssetCodeServiceRest/filterCatAssetCodeAutocomplete" 
							combo-id="cat_asset_detail_txtAssetGroup" 
							combo-source-link="catAssetCodeServiceRest/filterCatAssetCodeAutocomplete" 
							combo-name="caacName" 
							combo-value="catAssetCodeId" 
							combo-code="caacCode" 
							combo-search="vm.assetGroupSearch" 
							combo-grid="vm.gridCommon" 
							model-code="vm.detail.assetGroupCode"
							model-id="vm.detail.assetGroupId" 
							model-name="vm.detail.assetGroupName">
						</combo-box-asset>
						
						<combo-box-asset 
							searchtype="assetCode" 
							
							msg="Loại tài sản không được để trống"
							model-label="Loại tài sản" 
							caller="vm" 
							popup-id="cat_asset_detail_lotaType" 
							popup-type="grid" 
							popup-source-link="catAssetCodeServiceRest/filterCatAssetCodeAutocomplete" 
							combo-id="cat_asset_detail_txtLotaType" 
							combo-source-link="catAssetCodeServiceRest/filterCatAssetCodeAutocomplete" 
							combo-name="caacName" 
							combo-value="catAssetCodeId" 
							combo-code="caacCode" 
							combo-search="vm.assetTypeSearch" 
							combo-grid="vm.gridCommon" 
							model-code="vm.detail.assetTypeCode"
							model-id="vm.detail.assetTypeId" 
							model-name="vm.detail.assetTypeName">
						</combo-box-asset>
					</div>
					<div class="clearfix">
						<combo-box-asset 
							searchtype="assetSource" 
							
							msg="Dòng tài sản không được để trống"
							model-label="Dòng tài sản" 
							caller="vm" 
							popup-id="cat_asset_detail_assetSource" 
							popup-type="grid" 
							popup-source-link="catAssetCodeServiceRest/filterCatAssetCodeAutocomplete" 
							combo-id="cat_asset_detail_txtAssetSource" 
							combo-source-link="catAssetCodeServiceRest/filterCatAssetCodeAutocomplete" 
							combo-name="caacName" 
							combo-value="catAssetCodeId" 
							combo-code="caacCode" 
							combo-search="vm.catAssetSourceSearch" 
							combo-grid="vm.gridCommon" 
							model-code="vm.detail.assetSourceCode"
							model-id="vm.detail.assetSourceId" 
							model-name="vm.detail.assetSourceName">
						</combo-box-asset>
						
						<combo-box-asset 
							searchtype="catAsset" 
							req="req"
							msg="Tên tài sản không được để trống"
							model-label="Tên tài sản" 
							caller="vm" 
							popup-id="cat_asset_detail_assetName" 
							popup-type="grid" 
							popup-source-link="catAssetCodeServiceRest/filterCatAssetCodeAutocomplete" 
							combo-id="cat_asset_detail_txtAssetName" 
							combo-source-link="catAssetCodeServiceRest/filterCatAssetCodeAutocomplete" 
							combo-name="caacName" 
							combo-value="catAssetCodeId" 
							combo-code="caacCode" 
							combo-search="vm.catAssetCodeSearch" 
							combo-grid="vm.gridCommon" 
							model-code="vm.detail.assetNameCode"
							model-id="vm.detail.catAssetCodeId" 
							model-name="vm.detail.assetNameName">
						</combo-box-asset>
					</div>
					<div class="clearfix">
						<div class="margin-bottom-asset col-md-6">
							<label class="col-md-4 control-label req" translate>Mã tài sản</label>
							<div class="col-md-8">
								<input type="text" class="form-control" name="lotaCode" id="lotaCode" maxlength="15" ng-model="vm.detail.lotaCode" readonly />
							</div>
						</div>
						<div class="margin-bottom-asset col-md-6">
							<label class="col-md-4 control-label req" translate>Nguyên giá Tài Sản (VNĐ)</label>
							<div class="col-md-8">
								<input type="text" class="form-control" name="originalPrice" id="originalPrice" ng-model="vm.detail.originalPrice" vt-currency   readonly />
							</div>
						</div>
					</div>

					<div class="clearfix">						
						<div class="margin-bottom-asset col-md-6">
							<label class="col-md-4 control-label req" translate>Nguồn vốn</label>
							<div class="col-md-8">
								<select class="form-control" id="createdSource" name="createdSource" style="width: 100%" 
									kendo-drop-down-list 
									k-data-text-field="'name'"
									k-data-value-field="'id'"
									k-data-source="vm.createdSource"
									ng-model="vm.detail.createdSource" 
									required 
									data-required-msg="Nguồn vốn không được để trống">
								</select>
							</div>
						</div>
					</div>
					<div class="clearfix">
						<div class="margin-bottom-asset col-md-6">
							<label class="col-md-4 control-label req" translate>Nguồn hình thành</label>
							<div class="col-md-8">
								<select class="form-control" id="voucherType" name="voucherType" style="width: 100%" 
									kendo-drop-down-list 
									k-data-text-field="'name'"
									k-data-value-field="'id'"
									k-data-source="vm.voucherType"
									ng-model="vm.detail.voucherType" 
									required 
									data-required-msg="Nguồn hình thành không được để trống">
								</select>
							</div>
						</div>
						<div class="margin-bottom-asset col-md-6">
							<label class="col-md-4 control-label req" translate>Trạng thái hình thành TS</label>
							<div class="col-md-8">
								<label><input type="radio" id="lotaStatus" name="lotaStatus" ng-checked="vm.detail.lotaStatus == 0" value="0"> Tạm tăng</label>
								<label><input type="radio" id="lotaStatus" name="lotaStatus" ng-checked="vm.detail.lotaStatus == 1" value="1"> Đã quyết toán</label>
							</div>
						</div>
					</div>
				</div>
			</form>
			<uib-tabset class="tabbable-custom">
				<uib-tab active="vm.tabs[0].active" heading="Danh sách chi phí hình thành tài sản">
					<div class="clearfix">
						<div class="form-group col-md-12">
							<table class="table table-bordered margin-top" style="margin-bottom: 0px;">
								<thead>
									<tr>
										<th>STT</th>
										<th>Hạng mục chi phí</th>
										<th>Giá trị (VNĐ)</th>
										<th></th>
									</tr>
								</thead>
								<tbody >
									
									<tr ng-repeat="item in vm.danhMucHangMucChiPhi">
										<td class="text-center">{{$index+1}}</td>
										<td class="text-left">{{item.name}}</td>
										<td class="text-right">{{vm.getTotalChiPhi(item.id)|currency:"":0}}</td>
										<td class="text-center">										
											<button type="button" class="btn btn-link" style="padding-bottom: 3px;padding-top: 2px;"  ng-click="vm.showPopup('merEntity')">Chi tiết</button>										
										</td>
									</tr>
									<tr>
									
								</tbody>
								<tfoot>
									<tr>
										<td></td>
										<td class="text-center">TỔNG</td>
										<!-- <td class="text-right">{{vm.totalCost|currency:"":0}}</td> -->
										<td class="text-right">{{vm.merEntityValue+vm.constructionAcceptanceValue|currency:"":0}}</td>
										<td></td>
									</tr>
								</tfoot>
							</table>
						</div>
					</div>
				</uib-tab>
				<uib-tab active="vm.tabs[1].active" heading="Danh sách chi phí phân bổ">
					<div class="clearfix">
						<div class="form-group col-md-12">
							<table id="tblDistribution" class="table table-bordered margin-top" style="margin-bottom: 0px;">
								<thead>
									<tr>
										<th width="3%" translate>STT</th>
										<th width="13%" translate>Hạng mục chi phí</th>
										<th width="13%" translate>Nội dung chi</th>
										<th width="12%" translate>Dự toán được duyệt</th>
										<th width="12%" translate>Giá trị thực hiện/tăng tài sản (VNĐ)</th>
										<th width="10%">Số chứng từ</th>
										<th width="10%">Ngày chứng từ</th>
										<th width="4%">Trạng thái</th>
										<th width="18%">File đính kèm</th>
										<th width="5%"></th>
									</tr>
								</thead>
								<tbody>
									<tr ng-repeat="item in vm.listCatAssetCost">
										<input type="hidden" ng-model="item.longTermAssetCostId"/>
										<td class="text-center">{{$index+1}}<input type="hidden" class="id"  /></td>
										<td >
											<select class="form-control" id="loacType" name="loacType" style="width: 100%" 
												kendo-drop-down-list 
												k-data-text-field="'name'"
												k-data-value-field="'id'"
												k-data-source="vm.danhMucHangMucChiPhi"
												ng-model="item.loacType" >
											</select>
										</td>
										<td>
											<input type="text" ng-model="item.contentCost" class="form-control code" maxlength="100" />
										</td>
										<td>
											<input type="text" ng-model="item.estimateLoacValue" vt-currency maxlength="12" class="form-control value text-right" onkeypress="return event.charCode >= 48 && event.charCode <= 57" onchange="changeCurrency(this)" />
										</td>
										<td>
											<input type="text" ng-model="item.loacValue" vt-currency maxlength="12" class="form-control value text-right" onkeypress="return event.charCode >= 48 && event.charCode <= 57" onchange="changeCurrency(this)" />
										</td>
										<td>
											<input type="text" ng-model="item.voucherCode" class="form-control code" maxlength="50" />
										</td>
										<td>
											<input class="form-control date" ng-model="item.voucherDate"  kendo-date-picker data-date-msg="Ngày không đúng định dạng!" id="firstItem" name="inputDate" k-format="'dd/MM/yyyy'" />
											<span data-for="inputDate" class="k-invalid-msg"></span>										
										</td>
										<td>
											<select class="form-control" id="voucherStatus" name="voucherStatus" style="width: 100%" 
												kendo-drop-down-list 
												k-data-text-field="'name'"
												k-data-value-field="'id'"
												k-data-source='[{name:"Tạm tính",id:1},{name:"Quyết toán",id:2}]'
												ng-model="item.voucherStatus" 
												ng-init="item.voucherStatus=1">
												
											</select>
										</td>
										<td>
											<simple-upload-file ng-model="item.attachName" />
											<!-- <div class="input-group input-group-file">
												<input type="file" accept=".doc, .xls, .pdf"  style="display: none;" on-change-file="item.changeAttachFile"/>												 
												<input type="text" class="form-control att file" placeholder="Chọn file..." ng-model="item.attachDisplayName" readonly onchange="angular.element(this).scope().txtChoseDisFile(this)" />
												
												<span class="input-group-btn">
													<button class="btn btn-default btn-sm" type="button" style="padding-bottom: 3px; padding-top: 2px;" onclick="angular.element(this).scope().choseDisFile(this)">Browser</button>
												</span>
												<input type="hidden" ng-model="item.attachName" />																								
											</div> -->
										</td>
										<td class="text-center" style="width: 80px;">
											<div class="btn-group">
												<button type="button" class="btn btn-link btn-xs" ng-click="vm.extendListCatAssetCost();">
													<span class="glyphicon glyphicon-plus"></span>
												</button>
												<button type="button" class="btn btn-link btn-xs" ng-click="vm.removeCostItem(item,$index);">
													<span class="glyphicon glyphicon-remove"></span>
												</button>
											</div>
										</td>
									</tr>
								</tbody>
								<tfoot>
									<tr>
										<td></td>
										<td class="text-center">TỔNG</td>
										<td></td>
										<td></td>
										<td class="text-right">{{vm.totalDis|currency:"":0}}</td>
										<td></td>
										<td></td>
										<td></td>
										<td></td>
									</tr>
								</tfoot>
							</table>
						</div>
					</div>
				</uib-tab>
				<uib-tab active="vm.tabs[2].active" heading="Danh sách file đính kèm">
					<div class="clearfix">
						<div class="form-group col-md-12">
							<table class="table table-bordered margin-top" style="margin-bottom: 0px;">
								<thead>
									<tr>
										<th width="3%" translate>STT</th>
										<th width="40%" translate>Nội dung file</th>																			
										<th width="40%" translate>File đính kèm</th>
										<th width="7%" translate></th>
									</tr>
								</thead>
								<tbody>
									<tr ng-repeat="item in vm.listFileDinhKem">
										<td class="text-center" style="width: 80px;">{{$index+1}}<input type="hidden" class="id" /></td>
										<td class="text-center"><input type="text" ng-model="item.content" class="form-control code" maxlength="200" /></td>
										<td class="text-center">
											<simple-upload-file item="item" ng-model="item.attachName" />
											<!-- <div class="input-group input-group-file">
												<input type="file" accept=".doc, .xls, .pdf"  style="display: none;" on-change-file="item.changeAttachFile"/>												 
												<input type="text" class="form-control att file" placeholder="Chọn file..." ng-model="item.attachDisplayName" readonly onchange="angular.element(this).scope().txtChoseDisFile(this)" />												
												<span class="input-group-btn">
													<button class="btn btn-default btn-sm" type="button" style="padding-bottom: 3px; padding-top: 2px;" onclick="angular.element(this).scope().choseDisFile(this)">Browser</button>
												</span>
												<input type="hidden" ng-model="item.attachName" />												
												
											</div> -->
										</td>
										<td class="text-center" style="width: 80px;">
										
											<div class="btn-group">
												<button type="button" class="btn btn-link btn-xs" ng-click="vm.extendListDinhKem()">
													<span class="glyphicon glyphicon-plus"></span>
												</button>
												<button type="button" class="btn btn-link btn-xs" ng-click="vm.removeFileDinhKem($index)">
													<span class="glyphicon glyphicon-remove"></span>
												</button>
											</div>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</uib-tab>
			</uib-tabset>
			<form class="form-horizontal row" role="form">
				<div class="form-body">
					<div class="clearfix">
						<div class="row pull-right">
							<div class="col-md-12">
								<button type="button" class="btn default" translate ng-click="vm.cancel()">Hủy bỏ</button>
								<button id="btnSave" type="button" class="btn green" translate ng-click="vm.save()">Ghi lại</button>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>
<div class="loading-effect">
	<img src="assets/layouts/layout/img/loading-img.gif" />
</div>
<style>
	.loading-effect {
		display: none;
		position: absolute;
		top: 0px;
		bottom: 0px;
		left: 0px;
		right: 0px;
		background-color: rgba(216, 216, 224, 0.35);
		z-index: +99;
	}
	.loading-effect img{
		top: 50%;
		left: 50%;
		position: absolute;
	}
	.input-icon.right>.form-control {
		padding-left: inherit;
	}
</style>